<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="mapper.company">
	<resultMap id="comResult" type="companyVO">
		<result property="id" column="com_id" />
		<result property="name" column="com_name" />
		<result property="regDate" column="com_reg_date" />
		<result property="modDate" column="com_mod_date" />
		<result property="contractName" column="com_contract_name" />
		<result property="managerPhone" column="com_manager_phone" />
		<result property="managerEmail" column="com_manager_email" />
		<result property="contractStat" column="com_contract_stat" />
		<result property="contractType" column="com_contract_type" />
		<result property="homePage" column="com_homepage" />
		<result property="address" column="com_address" />
		<result property="contractAgree" column="com_contract_agree" />
		<result property="companyTel" column="com_tel" />
	</resultMap>
	
	<select id="selectAllCompaniesList" resultMap="comResult">
		<![CDATA[
			SELECT com_id, com_name, SUBSTR(com_reg_date, 0, 10) as com_reg_date, SUBSTR(com_mod_date,0,10) as com_mod_date, com_contract_name, 
			com_manager_phone, com_manager_email, com_contract_stat, com_contract_type, com_homePage, com_address, com_contract_agree, com_tel from company
			order by com_reg_date
			]]>
	</select>
	
	<!-- 검색할 수 있는 메소드 -->
	<select id="selectBySearchCompaniesList" resultMap="comResult" parameterType="java.util.Map" >
         select * from company         
	     <choose>
         	<when test="searchType == 'name'">
         		WHERE com_name LIKE '%' || #{searchText} || '%'
         	</when>
         	<when test="searchType =='contractName'">
         		WHERE com_contract_name LIKE '%' || #{searchText} || '%'
         	</when>
         </choose>
	</select>
	
	<select id="selectCompany" resultMap="comResult" parameterType="String">
		<![CDATA[
			select com_id, com_name, SUBSTR(com_reg_date, 0, 10) as com_reg_date, SUBSTR(com_mod_date,0,10) as com_mod_date, com_contract_name, 
			com_manager_phone, com_manager_email, com_contract_stat, com_contract_type, com_homepage, com_address, com_contract_agree, com_tel from company 
			where com_id = #{id}
		]]>
	</select>
	
	<!-- 협력회사 출력하기 -->
	<select id="selectAllPartnersList" resultMap="comResult">
		<![CDATA[
			SELECT com_id, com_name, SUBSTR(com_reg_date, 0, 10) as com_reg_date, SUBSTR(com_mod_date,0,10) as com_mod_date, com_contract_name, 
			com_manager_phone, com_manager_email, com_contract_stat, com_contract_type, com_homePage, com_address, com_contract_agree, com_tel from company 
			where com_contract_type = '협약 완료'
			order by com_reg_date
		]]>
	</select>
	
	<!-- 회사 삭제 쿼리 -->
	<delete id="deleteCompany"  parameterType="String">
		<![CDATA[
		delete from company
		where 
		com_id=#{id}
		]]>
	</delete>
	
	<!-- 회사 등록 쿼리 -->
	<insert id="insertCompany" parameterType="companyVO">
	<![CDATA[
		insert into company
		(com_id, com_name, com_contract_name, com_manager_phone, com_manager_email, com_contract_stat, com_contract_type, com_homepage, com_address, com_contract_agree, com_tel) 
		values
		(#{id}, #{name}, #{contractName}, #{managerPhone}, #{managerEmail}, #{contractStat}, #{contractType}, #{homePage}, #{address}, #{contractAgree}, #{companyTel})
	]]>
	</insert>
	
	<!-- 회사 수정 쿼리 -->
	<update id="updateCompany" parameterType="companyVO">
	<![CDATA[
		update company
	     set 
	     com_id=#{id}, com_name=#{name}, com_contract_name=#{contractName}, com_manager_phone=#{managerPhone}, 
	     com_manager_email=#{managerEmail}, com_contract_stat=#{contractStat}, com_contract_type=#{contractType}, com_homepage=#{homePage},
	     com_address=#{address}, com_contract_agree=#{contractAgree}, com_tel=#{companyTel} 
	     where com_id=#{id}
	]]>
	</update>
</mapper>